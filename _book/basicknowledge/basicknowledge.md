# 基础知识

　　本手册并不想详细说明，作为 tinc 的使用者，您只需要知道下面的大概就可以了。

原理，怎么用，什么步骤

对于本章节，大致了解步骤概念就可以了。着重需要看的是配置这一节。学会/理解了配置，其他都很简单。

## 1、安装 tinc

　　tinc 基于虚拟网卡进行通讯（操作系统中的 TAP/TUN 设备）。因此安装前要确认您的系统内核支持该功能。幸运的是，常见的内核都支持（某些需要安装模块或者驱动程序），您可以直接使用现成的预编译软件。

* Windows 内核支持，但需安装 OpenVPN 提供的虚拟网卡驱动；

* Mac OS X 内核支持，但需安装对应包，可通过包管理应用安装；

* Linux 常见发行版内核都支持，可通过包管理应用安装；

这些在后面的实例操作中都有操作说明，参见实例。

　　如果内核不支持，那么就需要配置内核、搭建工具链，重新编译和替换内核，然后再自行编译 tinc。您可以参阅官网或者本手册的进阶部分以获得更进一步的信息。



## 2、配置

tinc有着自己的配置文件结构、可配置项非常多。不用担心，只要了解最基本的就可以了，大部分使用默认参数即可。

本节说明最基本的配置文件，如果有进一步的需求，请参阅官网或者本手册的进阶部分以获得更进一步的信息。

tinc 基本配置文件说明：

tinc 的配置文件一般是一个目录，由一系列文件组成。一个最简单的配置目录结构是酱紫的（括号里面的是注释和说明）：



注意：脚本需要可执行的权限。对于 Unix Like 系统，需要 chmod+x，对于windows系统，需要增加 “.bat”后缀名。

```
$TINC_CONFIG_DIR
     └── NETNAME_1 （tinc 网络的名称，在启动 tinc 的时候作为标识）
     		├── hosts （放置本节点要连接到的各节点的基本配置信息）
     		│   ├── HOST_1 （主机1的配置文件）
     		│   ├── HOST_2 （主机2的配置文件）
     		│   ├── ...
     		│   └── HOST_n （节点n的配置文件）
     		├── rsa_key.priv （由 tincd 生成的本主机使用的非对称私钥，加密通讯使用）
     		├── tinc.conf （tinc 网络的配置文件）
	 		├── tinc-down （关闭该网络时，会调用执行的脚本，可选）
	 		└── tinc-up （启动该网络时，会调用执行的脚本，可选）
```

最简单的配置文件是酱紫的

tinc.conf

```
Name = node_010_034_034_102
AddressFamily = ipv4
Cipher = aes-256-cbc
Digest = SHA512
#Interface = /dev/tap0
Device = /dev/tap0

Port = 34

Compression = 11

ConnectTo = node_010_034_000_001

```

rsa_key.priv

tinc-down

```
#!/bin/sh

ifconfig $INTERFACE down
```

tinc-up

```
#!/bin/sh

#ifconfig $INTERFACE up
ifconfig $INTERFACE 10.34.34.102 netmask 255.255.0.0
```

/hosts/自己节点的描述文件和要connectto的主机描述文件。



- 配置文件

  [tinc.conf 配置文件说明](todo.md)

  - [host 配置项目说明](todo.md)

- [生成秘钥，传递公钥](todo.md)

- [运行软件](todo.md)

- [检查生效](todo.md)

- [完成](todo.md)

## 













































## 技术实现

虚拟网卡，操作系统中的一种TAP/TUN设备，是模拟出来的一种网卡。可以类比您机器上安装的实体网卡。tinc基于虚拟网卡进行通讯。对于上层软件应用来说，虚拟网卡和实体网卡并没有什么不同，所以上层软件不需要任何修改和适配。

所以要使用，首先您的OS要支持TAP/TUN（目前常见的系统都支持）。第二要运行tinc。第三，画个图说明tinc网络中数据是怎么传输的，是怎么建立连接的。



## 可以跳过本章节，直接看实例，然后反过头来看这个。下面说的比较详细，普通用户可以不用看，看后面实例就足够了。



## tinc是怎么运行的？各种脚本的执行如何按次序执行？都支持哪些脚本？



## How2use

- [安装](todo.md)
- [tinc配置](todo.md)
  - [tinc.conf 配置文件说明](todo.md)
  - [host 配置项目说明](todo.md)
- [生成秘钥，传递公钥](todo.md)
- [运行软件](todo.md)
- [检查生效](todo.md)
- [完成](todo.md)









## 如何使用



**这里是草稿**：

复制代码

注：某些系统可能会有点差异，但差不多就这个意思，万变不离其宗，各位自己融会贯通一下。

实际操作：

基本需求：

将目前常用的机器用 tinc 组成一 个VPN，虚拟专用网络命名为 vnet34。VPN 网络地址为 10.10.0.0/255.255.0.0（我贪方便用的B类地址，其实一般来说C类够用了，255个呢）。

网络拓扑：

我整理了一下我需要处理的情况，如下图：

![img](http://www.meishixiazheteng.com/data/attachment/forum/201806/13/152624clmbpck8k83thi1m.png) 



A 互联网上的机器，绑定了公网IP，可以直接访问公网。tinc 网络里的其他设备需能直接访问这些设备，需要在每台设

备上安装 tinc。

B 互联网上的机器，没有绑定公网IP。可以访问公网、但外部无法直接访问该机器。tinc 网络里的其他设备需能直接访问这些设备，需要在每台设备上安装 tinc。

C 位于路由器后面的设备，tinc 网络里的设备需能直接访问这些设备，需要在每台设备上安装 tinc。

D 位于路由器后面的设备，tinc 网络里的设备无需直接访问这些设备，设备上不需安装，只需在路由上安装 tinc 即可。

C 和 D 有点象，在实际操作中，可以是混用的。比如，我的工作机器上跑了不少虚拟机需要被直接访问，就在这些机器上都安装了 tinc。而对于有些人来说，他们只需要能访问 tinc 网络就可以了，还特喜欢瞎折腾机器（时不时的重装一下啥的）。我要是在他们的机器设备上安装 tinc 那真是烦透了。这种情况，在路由器上装上，让他们通过路由透明代理到 tinc 网络就可以了。









tinc 是个对等的网络，没有 server 和 client 之分，每个连接的设备都视为一个主机。各台机器上的配置文件都差不多。对于普通使用者来说，tinc的使用和其他软件并没有太大的不同。一般下面几个步骤就足够了：

安装，配置，运行

## 